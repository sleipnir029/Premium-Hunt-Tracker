<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Hunt Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 30px;
            color: #333;
        }

        form {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            font-weight: bold;
        }

        input[type="text"],
        input[type="tel"],
        input[type="datetime-local"],
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23212121'%3E%3Cpath d='M10 12.586L6.707 9.293a1 1 0 011.414-1.414L10 10.172l2.879-2.88a1 1 0 111.414 1.415L10 12.586z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
        }

        button[type="submit"] {
            background-color: #4caf50;
            color: #fff;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button[type="submit"]:hover {
            background-color: #45a049;
        }

        .error-message {
            color: #ff0000;
            margin-top: 5px;
        }
        /* Responsive styles */
        @media screen and (max-width: 600px) {
            /* Adjust form elements */
            input[type="text"],
            select,
            textarea {
              width: 100%; /* Make inputs full width */
              margin-bottom: 10px; /* Add spacing between elements */
            }

            /* Adjust font sizes */
            body {
              font-size: 16px; /* Example: Set base font size */
            }
        }
    </style>
</head>
<body>
    <h1>Premium Hunt Tracker</h1>
    <!--<form id="huntForm">-->
    <form id="huntForm" onsubmit="return submitForm(this);">
        <label for="year">Year:</label>
        <select id="year" required>
            <option value="">Select Year</option>
            <option value="2024">2024</option>
            <option value="2025">2025</option>
            <option value="2026">2026</option>
            <option value="2027">2027</option>
            <option value="2028">2028</option>
            <option value="2029">2029</option>
            <option value="2030">2030</option>
        </select><br>

        <label for="month">Month:</label>
        <select id="month" required>
            <option value="">Select Month</option>
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
        </select><br>

        <label for="huntType">Hunt Type:</label>
        <select id="huntType" required>
            <option value="">Select Hunt Type</option>
            <!-- Auto populated from HuntType sheet -->
        </select><br>

        <label for="consumerName">Consumer Name:</label>
        <input type="text" id="consumerName" required><br>

        <label for="consumerMobile">Consumer Mobile Number:</label>
        <input type="tel" id="consumerMobile" pattern="[0-9]{11}" required><br>

        <label for="consumerAddress">Consumer Address:</label>
        <input type="text" id="consumerAddress" required><br>

        <label for="deviceName">Device Name:</label>
        <select id="deviceName" required>
            <option value="">Select Device Name</option>
            <!-- Auto populated from DeviceName sheet -->
        </select><br>

        <label for="quantity">Quantity:</label>
        <input type="text" id="quantity" pattern="[0-9]" maxlength="2" required><br>

        <label for="communicatedOffer">Communicated Offer:</label>
        <select id="communicatedOffer" required>
            <option value="">Select Communicated Offer</option>
            <!-- Auto populated from CommunicatedOffer sheet -->
        </select><br>

        <label for="referralMobile">Referral Mobile Number:</label>
        <input type="tel" id="referralMobile" pattern="[0-9]{11}" ><br>

        <label for="appointmentDateTime">Appointment Date and Time:</label>
        <input type="datetime-local" id="appointmentDateTime" required><br>

        <label for="territoryName">Territory Name:</label>
        <select id="territoryName" required>
            <option value="">Select Territory</option>
            <!-- Auto populated from Territory sheet -->
        </select><br>

        <label for="lspName">LSP Name:</label>
        <select id="lspName" required>
            <option value="">Select LSP Name</option>
            <!-- Cascading dropdown based on Territory selection -->
        </select><br>

        <label for="thanaName">Thana Name:</label>
        <select id="thanaName" required>
            <option value="">Select Thana Name</option>
            <!-- Cascading dropdown based on LSP Name selection -->
        </select><br>

        <label for="tlName">TL Name:</label>
        <select id="tlName" required>
            <option value="">Select TL Name</option>
            <!-- Auto populated from TLName sheet -->
        </select><br>

        <label for="technicianName">Technician Name:</label>
        <input type="text" id="technicianName" required><br>

        <label for="technicianRemarks">Technician Remarks:</label>
        <input type="text" id="technicianRemarks"><br>

        <!--<button onclick="submitForm()">Submit</button>-->
        <button type="submit" id="submitButton" onclick="submitForm()">Submit</button>
    </form>

    <script>

      /**
       * Auto-populates Hunt Type dropdown
       *
       * This function uses google.script.run to call the server-side function
       * getHuntTypeOptions(), which returns an array of options. Then it
       * iterates over the array and creates an option element for each item
       * in the array, appending the option element to the huntTypeDropdown
       */
      function populateHuntTypeDropdown() {
        google.script.run.withSuccessHandler(function(options) {
          var huntTypeDropdown = document.getElementById('huntType');

          options.forEach(function(option) {
            var optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            huntTypeDropdown.appendChild(optionElement);
          });
        }).getHuntTypeOptions();
      }

      /**
       * Auto-populates Device Name dropdown
       *
       * This function uses google.script.run to call the server-side function
       * getDeviceNameOptions(), which returns an array of options. Then it
       * iterates over the array and creates an option element for each item
       * in the array, appending the option element to the deviceNameDropdown
       */
      function populateDeviceNameDropdown() {
        google.script.run.withSuccessHandler(function(options) {
          var deviceNameDropdown = document.getElementById('deviceName');

          options.forEach(function(option) {
            var optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            deviceNameDropdown.appendChild(optionElement);
          });
        }).getDeviceNameOptions();
      }

      /**
       * Auto-populates Communicated Offer dropdown
       *
       * This function uses google.script.run to call the server-side function
       * getCommunicatedOfferOptions(), which returns an array of options.
       * Then it iterates over the array and creates an option element for
       * each item in the array, appending the option element to the
       * communicatedOfferDropdown.
       */
      function populateCommunicatedOfferDropdown() {
        google.script.run.withSuccessHandler(function(options) {
          var communicatedOfferDropdown = document.getElementById('communicatedOffer');

          options.forEach(function(option) {
            var optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            communicatedOfferDropdown.appendChild(optionElement);
          });
        }).getCommunicatedOfferOptions();
      }


      /**
       * Auto-populates Territory Name dropdown
       *
       * This function uses google.script.run to call the server-side function
       * getTerritoryNameOptions(), which returns an array of options.
       * Then it iterates over the array and creates an option element for
       * each item in the array, appending the option element to the
       * territoryNameDropdown.
       */
      function populateTerritoryNameDropdown() {
        google.script.run.withSuccessHandler(function(options) {
          var territoryNameDropdown = document.getElementById('territoryName');

          options.forEach(function(option) {
            var optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            territoryNameDropdown.appendChild(optionElement);
          });
        }).getTerritoryNameOptions();
      }


      // When technician selects an offer which contains the word "Referral"
      // then the Referrer Mobile Numer field will be mandatory otherwise it remains optional
      function toggleReferralMobile() {
        var communicatedOfferDropdown = document.getElementById('communicatedOffer');
        var referralMobileInput = document.getElementById('referralMobile');

        // Regular expression to match variations of the word "referral"
        // var referralRegex = /ref(?:erral|r(?:efer|eferer))?\b/i;

        if (communicatedOfferDropdown.value.includes('Referral')) {
          referralMobileInput.required = true;
        } else {
          referralMobileInput.required = false;
        }
        console.log(referralMobileInput.required)
      }

      document.getElementById('communicatedOffer').addEventListener('change', toggleReferralMobile);

      // auto-populating LSP Name dropdown based on the value selected in the Territory Name dropown
      function populateLSPNameDropdown() {
        var territoryNameDropdown = document.getElementById('territoryName');
        var selectedTerritory = territoryNameDropdown.value;
        var lspNameDropdown = document.getElementById('lspName');
        lspNameDropdown.innerHTML = ''; // Clear existing options

        if (selectedTerritory) {
          google.script.run.withSuccessHandler(function(options) {
            options.forEach(function(option) {
              var optionElement = document.createElement('option');
              optionElement.value = option;
              optionElement.textContent = option;
              console.log(optionElement.value);
              lspNameDropdown.appendChild(optionElement);
            });
          }).getLSPNameOptions(selectedTerritory);
        } 
      }

      // call populateLSPNameDropdown when the value of the Territory dropdown changes
      document.getElementById('territoryName').addEventListener('change', populateLSPNameDropdown);



      function populateThanaDropdown() {
        var lspNameDropdown = document.getElementById('lspName');
        var selectedLSPName = lspNameDropdown.value;
        var thanaNameDropdown = document.getElementById('thanaName');
        thanaNameDropdown.innerHTML = ''; // Clear existing options
        
        // Get the selected LSP Name from the dropdown
        var selectedLSPName = lspNameDropdown.value;

        console.log(selectedLSPName)

        if (selectedLSPName) {
          google.script.run.withSuccessHandler(function(options) {
            options.forEach(function(option) {
              var optionElement = document.createElement('option');
              optionElement.value = option;
              optionElement.textContent = option;
              console.log(optionElement.value);
              thanaNameDropdown.appendChild(optionElement);
            });
          }).getThanaNameOptions(selectedLSPName);
        }
      }

      // Call populateThanaDropdown when the value of the LSP Name dropdown changes
      document.getElementById('lspName').addEventListener('change', populateThanaDropdown);

      // auto-populating TL Name dropdown
      function populateTLNameDropdown() {
        google.script.run.withSuccessHandler(function(options) {
          var tlNameDropdown = document.getElementById('tlName');
          options.forEach(function(option) {
            var optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.textContent = option;
            tlNameDropdown.appendChild(optionElement);
          });
        }).getTLNameOptions();
      }

    
      // call the functions for auto-populating dropdowns when the page loads
      window.onload = function() {
        populateHuntTypeDropdown();
        populateDeviceNameDropdown();
        populateCommunicatedOfferDropdown();
        populateTerritoryNameDropdown();
        populateLSPNameDropdown();
        populateThanaDropdown();
        populateTLNameDropdown();
      };



      /**
       * Submits the form data to the server-side function
       */
      function submitForm() {
        var year = document.getElementById('year').value;
        var month = document.getElementById('month').value;
        var huntType = document.getElementById('huntType').value;
        var consumerName = document.getElementById('consumerName').value;
        var consumerMobileNumber = document.getElementById('consumerMobile').value;
        var consumerAddress = document.getElementById('consumerAddress').value;
        var deviceName = document.getElementById('deviceName').value;
        var quantity = document.getElementById('quantity').value;
        var communicatedOffer = document.getElementById('communicatedOffer').value;
        var referralMobileNumber = document.getElementById('referralMobile').value;
        var appointmentDateTime = document.getElementById('appointmentDateTime').value;
        var territoryName = document.getElementById('territoryName').value;
        var lspName = document.getElementById('lspName').value;
        var thanaName = document.getElementById('thanaName').value;
        var tlName = document.getElementById('tlName').value;
        var technicianName = document.getElementById('technicianName').value;
        var technicianRemarks = document.getElementById('technicianRemarks').value;
        // Collect other form data similarly

        // Prepend country code to the mobile numbers
        consumerMobileNumber = "88" + consumerMobileNumber;
        if (referralMobileNumber) {
          referralMobileNumber = "88" + referralMobileNumber;
        } else{
          referralMobileNumber = ''
        }

        // Call server-side function to submit form data
        google.script.run.submitFormData(year, month, huntType, consumerName, consumerMobileNumber, consumerAddress, deviceName, quantity, communicatedOffer, referralMobileNumber, appointmentDateTime, territoryName, lspName, thanaName, tlName, technicianName, technicianRemarks);
        
        // Disable the submit button to prevent multiple submissions
        var submitButton = document.getElementById('submitButton');
        submitButton.disabled = true;

        // Simulate form submission (replace this with your actual submission logic)
        setTimeout(function() {
          // Enable the submit button
          submitButton.disabled = false;

          // Show submission success message
          alert("Submission Successful");

          // Reload the page to allow for another submission
          location.reload();
        }, 1000); // Simulate a delay of 1 second for submission
      }

    </script>
</body>
</html>